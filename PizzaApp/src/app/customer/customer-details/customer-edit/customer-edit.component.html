<div class="card">
  <div class="card-content">
    <form [formGroup]="customerFormGroup" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-12 col-md-3">
          <mat-form-field>
            <mat-label>First name</mat-label>
            <input matInput formControlName="firstName"/>
            @if (customerFormGroup.get('firstName')?.invalid && (customerFormGroup.get('firstName')?.dirty || customerFormGroup.get('firstName')?.touched)) {
              <mat-error>
                @if (customerFormGroup.get('firstName')?.errors?.['required']) {
                  <span>First name required</span>
                }
              </mat-error>
            }
          </mat-form-field>
        </div>

        <div class="col-12 col-md-3">
          <mat-form-field>
            <mat-label>Last name</mat-label>
            <input matInput formControlName="lastName"/>
            @if (customerFormGroup.get('lastName')?.invalid && (customerFormGroup.get('lastName')?.dirty || customerFormGroup.get('lastName')?.touched)) {
              <mat-error>
                @if (customerFormGroup.get('lastName')?.errors?.['required']) {
                  <span>Last name required</span>
                }
              </mat-error>
            }
          </mat-form-field>
        </div>

        <div class="col-12 col-md-3">
          <mat-form-field>
            <mat-label>Email</mat-label>
            <input matInput type="email" [formControl]="emailFormControl"/>
            @if (emailFormControl.invalid && (emailFormControl.dirty || emailFormControl.touched)) {
              <mat-error>
                @if (emailFormControl.errors?.['required']) {
                  <span>Email required</span>
                }
                @if (emailFormControl.errors?.['email']) {
                  <span>Email not valid</span>
                }
                @if (emailFormControl.errors?.['uniqueEmail']) {
                  <span>Email taken</span>
                }
                @if (emailFormControl.errors && !emailFormControl.errors['email'] && emailFormControl.errors['forbiddenEmail']) {
                  <span>Email forbidden</span>
                }
              </mat-error>
            }
          </mat-form-field>
        </div>

        <div class="col-12 col-md-3">
          <mat-form-field>
            <mat-label>Phone</mat-label>
            <input matInput formControlName="phone"/>
          </mat-form-field>
        </div>
      </div>

      <h6>Address</h6>

      <ng-container formGroupName="address">
        <div class="row">
          <div class="col-12 col-md-3">
            <mat-form-field>
              <mat-label>Street</mat-label>
              <input matInput formControlName="street"/>
            </mat-form-field>
          </div>
          <div class="col-12 col-md-3">
            <mat-form-field>
              <mat-label>City</mat-label>
              <input matInput
                     formControlName="city"
                     type="text"
                     [matAutocomplete]="cityAutocomplete"/>
              <mat-autocomplete autoActiveFirstOption #cityAutocomplete="matAutocomplete">
                @for (option of filteredCities$ | async; track option) {
                  <mat-option [value]="option">
                    {{ option }}
                  </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-12 col-md-3">
            <mat-form-field>
              <mat-label>Zip Code</mat-label>
              <input matInput formControlName="zipCode"/>
            </mat-form-field>
          </div>
          <div class="col-12 col-md-3">
            <mat-form-field>
              <mat-label>Country</mat-label>
              <mat-select formControlName="country">
                @for (country of countries; track country.code) {
                  <mat-option [value]="country.code">
                    {{ country.name }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </ng-container>

      <div class="d-flex justify-content-end">
        <button mat-raised-button
                color="primary"
                type="submit"
                [disabled]="customerFormGroup.invalid">
          Save
        </button>
      </div>
    </form>

    <div class="row">
      <div class="col-12 col-md-6">
        <p>Initial value</p>
        <code>
          <pre>{{ customer | json }}</pre>
        </code>
      </div>
      <div class="col-12 col-md-6">
        <p>Form value</p>
        <code>
          <pre>{{ customerFormGroup.value | json }}</pre>
        </code>
      </div>
    </div>
  </div>
</div>
